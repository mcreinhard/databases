// Generated by CoffeeScript 1.7.1
(function() {
  var data, messages, _;

  _ = require('underscore');

  messages = {};

  data = [];

  messages.add = function(message) {
    var key, _i, _len, _ref;
    _ref = ['username', 'text', 'roomname'];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      key = _ref[_i];
      if (message[key] == null) {
        message[key] = '';
      }
    }
    message.createdAt = (new Date()).toJSON();
    return data.push(message);
  };

  messages.get = function(options) {
    var filter, k, key, sort, v, val, _ref, _ref1;
    filter = _.identity;
    sort = _.identity;
    if ((options != null ? options.filter : void 0) != null) {
      _ref = options.filter;
      for (k in _ref) {
        v = _ref[k];
        _ref1 = [k, v], key = _ref1[0], val = _ref1[1];
      }
      if (key != null) {
        filter = function(list) {
          return _(list).filter((function(x) {
            return x[key] === val;
          }));
        };
      }
    }
    if ((options != null ? options.order : void 0) != null) {
      sort = options.order[0] === '-' ? function(list) {
        return (_(list).sortBy(options.order.slice(1))).reverse();
      } : function(list) {
        return _(list).sortBy(options.order);
      };
    }
    return filter(sort(data));
  };

  module.exports = messages;

}).call(this);

//# sourceMappingURL=messages.map
